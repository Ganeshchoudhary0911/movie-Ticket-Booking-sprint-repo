<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Select Seats</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

  <!-- Top bar with movie/theatre/date/time -->
  <div class="container-fluid bg-white border-bottom py-3">
    <div class="container">
      <h5 class="mb-1" th:text="${movieName}">Movie Name</h5>
      <small class="text-muted">
        <span th:text="${theatreName}">Theatre</span>
        ·
        <span th:text="${showDate}">Date</span>
        ·
        <span th:text="${showTime}">Time</span>
      </small>
    </div>
  </div>

  <!-- Seat grid -->
  <div class="container my-4 text-center">

    <!-- GOLD -->
    <div class="fw-bold mb-2">GOLD · ₹150</div>
    <div class="d-flex justify-content-center align-items-center gap-2 mb-3">
      <div class="fw-bold me-2">A</div>
      <button class="btn btn-outline-success seat" data-price="150">1</button>
      <button class="btn btn-outline-success seat" data-price="150">2</button>
      <button class="btn btn-outline-success seat" data-price="150">3</button>
      <button class="btn btn-outline-success seat" data-price="150">4</button>
      <button class="btn btn-outline-success seat" data-price="150">5</button>
      <button class="btn btn-outline-success seat" data-price="150">6</button>
      <button class="btn btn-outline-success seat" data-price="150">7</button>
      <button class="btn btn-outline-success seat" data-price="150">8</button>
      <button class="btn btn-outline-success seat" data-price="150">9</button>
      <button class="btn btn-outline-success seat" data-price="150">10</button>
    </div>

    <div class="d-flex justify-content-center align-items-center gap-2 mb-4">
      <div class="fw-bold me-2">B</div>
      <button class="btn btn-outline-success seat" data-price="150">1</button>
      <button class="btn btn-outline-success seat" data-price="150">2</button>
      <button class="btn btn-outline-success seat" data-price="150">3</button>
      <button class="btn btn-outline-success seat" data-price="150">4</button>
      <button class="btn btn-outline-success seat" data-price="150">5</button>
      <button class="btn btn-outline-success seat" data-price="150">6</button>
      <button class="btn btn-outline-success seat" data-price="150">7</button>
      <button class="btn btn-outline-success seat" data-price="150">8</button>
      <button class="btn btn-outline-success seat" data-price="150">9</button>
      <button class="btn btn-outline-success seat" data-price="150">10</button>
    </div>

    <div class="d-flex justify-content-center align-items-center gap-2 mb-4">
      <div class="fw-bold me-2">C</div>
      <button class="btn btn-outline-success seat" data-price="150">1</button>
      <button class="btn btn-outline-success seat" data-price="150">2</button>
      <button class="btn btn-outline-success seat" data-price="150">3</button>
      <button class="btn btn-outline-success seat" data-price="150">4</button>
      <button class="btn btn-outline-success seat" data-price="150">5</button>
    </div>

    <div class="d-flex justify-content-center align-items-center gap-2 mb-4">
      <div class="fw-bold me-2">D</div>
      <button class="btn btn-outline-success seat" data-price="150">1</button>
      <button class="btn btn-outline-success seat" data-price="150">2</button>
      <button class="btn btn-outline-success seat" data-price="150">3</button>
      <button class="btn btn-outline-success seat" data-price="150">4</button>
      <button class="btn btn-outline-success seat" data-price="150">5</button>
    </div>

    <div class="d-flex justify-content-center align-items-center gap-2 mb-4">
      <div class="fw-bold me-2">E</div>
      <button class="btn btn-outline-success seat" data-price="150">1</button>
      <button class="btn btn-outline-success seat" data-price="150">2</button>
      <button class="btn btn-outline-success seat" data-price="150">3</button>
      <button class="btn btn-outline-success seat" data-price="150">4</button>
      <button class="btn btn-outline-success seat" data-price="150">5</button>
    </div>

    <div class="d-flex justify-content-center align-items-center gap-2 mb-4">
      <div class="fw-bold me-2">F</div>
      <button class="btn btn-outline-success seat" data-price="150">1</button>
      <button class="btn btn-outline-success seat" data-price="150">2</button>
      <button class="btn btn-outline-success seat" data-price="150">3</button>
      <button class="btn btn-outline-success seat" data-price="150">4</button>
      <button class="btn btn-outline-success seat" data-price="150">5</button>
    </div>

    <!-- SILVER -->
    <div class="fw-bold mb-2">SILVER · ₹100</div>
    <div class="d-flex justify-content-center align-items-center gap-2 mb-3">
      <div class="fw-bold me-2">G</div>
      <button class="btn btn-outline-success seat" data-price="100">1</button>
      <button class="btn btn-outline-success seat" data-price="100">2</button>
      <button class="btn btn-outline-success seat" data-price="100">3</button>
      <button class="btn btn-outline-success seat" data-price="100">4</button>
      <button class="btn btn-outline-success seat" data-price="100">5</button>
    </div>

    <div class="d-flex justify-content-center align-items-center gap-2 mb-5">
      <div class="fw-bold me-2">H</div>
      <button class="btn btn-outline-success seat" data-price="100">1</button>
      <button class="btn btn-outline-success seat" data-price="100">2</button>
      <button class="btn btn-outline-success seat" data-price="100">3</button>
      <button class="btn btn-outline-success seat" data-price="100">4</button>
      <button class="btn btn-outline-success seat" data-price="100">5</button>
    </div>

    <div class="d-flex justify-content-center align-items-center gap-2 mb-5">
      <div class="fw-bold me-2">I</div>
      <button class="btn btn-outline-success seat" data-price="100">1</button>
      <button class="btn btn-outline-success seat" data-price="100">2</button>
      <button class="btn btn-outline-success seat" data-price="100">3</button>
      <button class="btn btn-outline-success seat" data-price="100">4</button>
      <button class="btn btn-outline-success seat" data-price="100">5</button>
    </div>

    <div class="d-flex justify-content-center align-items-center gap-2 mb-5">
      <div class="fw-bold me-2">J</div>
      <button class="btn btn-outline-success seat" data-price="100">1</button>
      <button class="btn btn-outline-success seat" data-price="100">2</button>
      <button class="btn btn-outline-success seat" data-price="100">3</button>
      <button class="btn btn-outline-success seat" data-price="100">4</button>
      <button class="btn btn-outline-success seat" data-price="100">5</button>
      <button class="btn btn-outline-success seat" data-price="100">6</button>
      <button class="btn btn-outline-success seat" data-price="100">7</button>
      <button class="btn btn-outline-success seat" data-price="100">8</button>
      <button class="btn btn-outline-success seat" data-price="100">9</button>
      <button class="btn btn-outline-success seat" data-price="100">10</button>
    </div>

    <div class="text-primary fw-bold mb-4">All eyes this way please!</div>
  </div>

  <!-- Hidden form to create a booking (no layout impact) -->
  <form id="confirmForm"
        th:action="@{/confirm/{showId}(showId=${showId})}"
        method="post"
        class="d-none">
    <input type="hidden" name="amount" id="amountField" />
    <!-- CSRF (optional if you use Spring Security) -->
    <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
  </form>

  <!-- Bottom bar with Pay button (hidden until a seat is selected) -->
  <div id="paymentBar" class="fixed-bottom bg-white border-top d-none">
    <div class="container d-flex justify-content-between align-items-center py-3">
      <div>
        <strong><span id="seatCount">0</span></strong> Seats |
        ₹<strong><span id="totalAmount">0</span></strong>
      </div>
      <button class="btn btn-danger px-4" onclick="goToPayment()">
        Pay ₹<span id="payAmount">0</span>
      </button>
    </div>
  </div>

  <script>
    let selectedPrices = [];

    // Attach click handlers to seat buttons
    document.querySelectorAll('.seat').forEach(seat => {
      if (!seat.classList.contains('disabled')) {
        seat.addEventListener('click', () => {
          const price = parseInt(seat.dataset.price, 10);

          if (seat.classList.contains('btn-success')) {
            seat.classList.remove('btn-success');
            seat.classList.add('btn-outline-success');
            const idx = selectedPrices.indexOf(price);
            if (idx > -1) selectedPrices.splice(idx, 1);
          } else {
            seat.classList.remove('btn-outline-success');
            seat.classList.add('btn-success');
            selectedPrices.push(price);
          }

          updatePayment();
        });
      }
    });

    function updatePayment() {
      const count = selectedPrices.length;
      const total = selectedPrices.reduce((a, b) => a + b, 0);

      document.getElementById('seatCount').innerText = count;
      document.getElementById('totalAmount').innerText = total;
      document.getElementById('payAmount').innerText = total;

      const bar = document.getElementById('paymentBar');
      bar.classList.toggle('d-none', count === 0);
    }

    function goToPayment() {
      const count = parseInt(document.getElementById('seatCount').innerText, 10);
      const total = parseFloat(document.getElementById('payAmount').innerText);

      if (!count || count === 0) {
        alert("Please select seats");
        return;
      }

      // Post to /confirm/{showId}?amount={total}
      document.getElementById('amountField').value = total;
      document.getElementById('confirmForm').submit();
    }
  </script>

</body>
</html>