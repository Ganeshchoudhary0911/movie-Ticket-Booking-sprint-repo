<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
<title th:text="${movie.movieId != null} ? 'Edit Movie' : 'Add Movie'">
    Movie Form
</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet"/>

  <style>.required::after{content:" *";color:#dc3545}</style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand fw-semibold" th:href="@{/admin/dashboard}">Admin Panel</a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="nav" class="collapse navbar-collapse">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link" th:href="@{/admin/movies}">Movies</a></li>
        <li class="nav-item"><a class="nav-link" th:href="@{/admin/theatres}">Theatres</a></li>
        <li class="nav-item"><a class="nav-link" th:href="@{/admin/shows}">Shows</a></li>
        
      </ul>
      <a class="btn btn-outline-light" th:href="@{/logout}">
        <i class="bi bi-box-arrow-right me-1"></i> Logout
      </a>
    </div>
  </div>
</nav>

<main class="container py-4">

  <div class="d-flex align-items-center justify-content-between mb-3">
<h2 class="mb-0"
    th:text="${movie.movieId != null} ? 'Edit Movie' : 'Add Movie'">Add Movie</h2>
        <a class="btn btn-secondary" th:href="@{/admin/movies}">
      <i class="bi bi-arrow-left"></i> Back
    </a>
  </div>

  <!-- ⭐ FORM CHANGES MADE HERE ⭐ -->
  <form th:action="${movie != null and movie.movieId != null} 
                   ? @{/admin/movies/{id}(id=${movie.movieId})} 
                   : @{/admin/movies}"
        th:object="${movie}"
        method="post"
        class="row g-3">

    <!-- ⭐ Hidden input: only shown for PUT -->
    <div th:if="${movie != null and movie.movieId != null}">
      <input type="hidden" name="_method" value="put"/>
    </div>

    <!-- Hidden movieId always present to bind back -->
    <input type="hidden" th:field="*{movieId}"/>

    <!-- Movie Name -->
    <div class="col-12 col-md-6">
      <label class="form-label required">Movie Name</label>
      <input type="text" class="form-control" th:field="*{movieName}" required maxlength="150"/>
      <div class="text-danger small" th:if="${#fields.hasErrors('movieName')}" th:errors="*{movieName}"></div>
    </div>

    <!-- Language -->
    <div class="col-12 col-md-6">
      <label class="form-label required">Language</label>
      <input type="text" class="form-control" th:field="*{language}" required maxlength="50"/>
      <div class="text-danger small" th:if="${#fields.hasErrors('language')}" th:errors="*{language}"></div>
    </div>

    <!-- Genre -->
    <div class="col-12 col-md-6">
      <label class="form-label required">Genre</label>
      <input type="text" class="form-control" th:field="*{genre}" required maxlength="100"/>
      <div class="text-danger small" th:if="${#fields.hasErrors('genre')}" th:errors="*{genre}"></div>
    </div>

    <!-- Duration -->
    <div class="col-12 col-md-6">
      <label class="form-label required">Duration (minutes)</label>
      <input type="number" min="1" max="500" class="form-control" th:field="*{duration}" required/>
      <div class="text-danger small" th:if="${#fields.hasErrors('duration')}" th:errors="*{duration}"></div>
    </div>

    <!-- Description -->
    <div class="col-12">
      <label class="form-label required">Description</label>
      <textarea rows="4" class="form-control" th:field="*{description}" required maxlength="2000"></textarea>
      <div class="text-danger small" th:if="${#fields.hasErrors('description')}" th:errors="*{description}"></div>
    </div>

    <!-- Rating -->
    <div class="col-12 col-md-6">
      <label class="form-label required">Rating (0.0 - 10.0)</label>
      <input type="number" step="0.1" min="0" max="10" class="form-control" th:field="*{rating}" required/>
      <div class="text-danger small" th:if="${#fields.hasErrors('rating')}" th:errors="*{rating}"></div>
    </div>

    <!-- Poster URL -->
    <div class="col-12 col-md-6">
      <label class="form-label">Poster URL</label>
      <input type="url" placeholder="https://..." class="form-control" th:field="*{posterUrl}"/>
      <div class="form-text">Paste a direct image URL (JPG/PNG).</div>
      <div class="text-danger small" th:if="${#fields.hasErrors('posterUrl')}" th:errors="*{posterUrl}"></div>
    </div>

    <!-- Submit -->
    <div class="col-12">
      <button type="submit" class="btn btn-primary">
        <i class="bi bi-save me-1"></i>
        <span th:text="${movie != null and movie.movieId != null} ? 'Save Changes' : 'Create Movie'">Create Movie</span>
      </button>
      <a class="btn btn-outline-secondary ms-2" th:href="@{/admin/movies}">
        <i class="bi bi-x-circle me-1"></i> Cancel
      </a>
    </div>

  </form>
</main>

<footer class="text-center text-muted py-4">
  <small>&copy; <span th:text="${#dates.format(#dates.createNow(), 'yyyy')}"></span> Admin Portal</small>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>