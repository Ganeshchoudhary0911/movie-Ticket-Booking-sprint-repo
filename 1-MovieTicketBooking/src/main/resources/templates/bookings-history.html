<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Booking History | TicketNest</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div th:replace="~{fragments/header :: header}"></div>

    <div class="container mt-4">
        <h3 class="fw-bold mb-3">Booking History</h3>

        <!-- Null/empty safe -->
        <div th:if="${bookings == null or #lists.isEmpty(bookings)}" class="alert alert-secondary">
            No past bookings yet.
        </div>

        <div th:if="${bookings != null and !#lists.isEmpty(bookings)}" class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Booking #</th>
                        <th>Booking Date</th>
                        <th>Status</th>
                        <th>Payment</th>
                        <th>Total</th>
                        <th></th>
                    </tr>
                </thead>

                <tbody>
                    <tr th:each="b : ${bookings}">
                        <td th:text="${b.bookingId}">1001</td>

                        <td th:text="${#temporals.format(b.bookingDate, 'dd MMM yyyy')}">12 Jan 2026</td>

                        <!-- SINGLE-LINE expression (prevents parser errors) -->
                        <td>
                            <span class="badge"
                                  th:classappend="${b.bookingStatus != null and b.bookingStatus.equalsIgnoreCase('CANCELLED') ? ' bg-secondary' : (b.paymentStatus != null and b.paymentStatus.equalsIgnoreCase('FAILED') ? ' bg-danger' : ' bg-success')}"
                                  th:text="${b.bookingStatus}">
                                CANCELLED
                            </span>
                        </td>

                        <td th:text="${b.paymentStatus}">PAID</td>

                        <!-- Amount: always 2 decimals; null-safe -->
                        <td th:text="${b.totalAmount != null ? #numbers.formatDecimal(b.totalAmount, 1, 2) : '0.00'}">150.00</td>

                        
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div th:replace="~{fragments/footer :: footer}"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</body>
</html>