<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
<meta charset="UTF-8" />
<title>Payment Failed</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet" />
<style>
.lead-small {
	font-size: 1.05rem;
}

.kv {
	display: flex;
	justify-content: space-between;
	align-items: center;
}

.badge-status {
	font-size: 0.8rem;
}
</style>
</head>
<body class="bg-light">

	<div class="container mt-5">
		<div class="card shadow-sm border-danger">
			<div class="card-body">
				<div class="d-flex align-items-center gap-2 mb-2">
					<span class="fs-3">❌</span>
					<h2 class="text-danger fw-bold mb-0">Payment Failed</h2>
				</div>

				<p class="text-muted lead-small mb-1">Unfortunately, your
					payment could not be processed.</p>
				<p class="text-muted lead-small">You can retry the payment or
					choose a different payment method.</p>

				<!-- Reason block (if provided from gateway/controller) -->
				<div th:if="${failureReason != null}"
					class="alert alert-warning mt-3">
					<strong>Reason:</strong> <span th:text="${failureReason}">Your
						bank declined the transaction.</span>
				</div>

				<hr>

				<h5 class="fw-bold">Booking Details</h5>
				<ul class="list-group mb-4">
					<li class="list-group-item d-flex justify-content-between"><strong>Booking
							ID:</strong> <span th:text="${booking.bookingId}">123</span></li>

					<li class="list-group-item d-flex justify-content-between"
						th:if="${booking.show != null}"><strong>Show:</strong> <span
						th:text="${booking.show.title}">Show</span></li>

					<li class="list-group-item d-flex justify-content-between"><strong>Booking
							Status:</strong> <span class="badge bg-secondary badge-status"
						th:text="${booking.bookingStatus != null ? booking.bookingStatus : 'PENDING'}">PENDING</span>
					</li>

					<li class="list-group-item d-flex justify-content-between"><strong>Payment
							Status:</strong> <span class="badge bg-danger badge-status"
						th:text="${booking.paymentStatus != null ? booking.paymentStatus : 'FAILED'}">FAILED</span>
					</li>

					<li class="list-group-item d-flex justify-content-between"><strong>Amount:</strong>
						<span>₹<span
							th:text="${#numbers.formatDecimal(booking.totalAmount,1,'COMMA',2,'POINT')}">0.00</span></span>
					</li>
				</ul>

				<!-- Actions -->
				<div class="d-flex flex-wrap gap-3 align-items-center">
					<!-- Retry the same booking and amount -->
					<a th:href="@{/payment/method(bookingId=${booking.bookingId})}"
						class="btn btn-primary"> Retry Payment </a>

					<!-- Optional: alternative method page, if you have a separate route -->
					<a th:href="@{/payment/methods(bookingId=${booking.bookingId})}"
						class="btn btn-outline-primary"
						th:if="${#bools.isTrue(showAllMethods)}"> Choose Different
						Method </a> <a th:href="@{/bookings/history}"
						class="btn btn-outline-secondary"> View Booking History </a>

					<!-- Support -->
					<a th:href="@{/support?bookingId={bid}(bid=${booking.bookingId})}"
						class="btn btn-link text-danger"> Contact Support </a>
				</div>

				<!-- Optional: auto-redirect back to payment method after a short delay -->
				<p class="text-muted mt-3" id="redirect-note"
					th:if="${#bools.isTrue(autoRedirect)}">
					Redirecting to payment options in <span id="countdown">10</span>s…
				</p>

			</div>
		</div>
	</div>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js">
		
	</script>

	<script th:if="${#bools.isTrue(autoRedirect)}">
		// Simple countdown + redirect
		(function() {
			const targetUrl = /*[[ @{/payment/method(bookingId=${booking.bookingId})} ]]*/'';
			let secs = 10, el = document.getElementById('countdown');
			const timer = setInterval(function() {
				if (!el)
					return clearInterval(timer);
				el.textContent = secs;
				if (secs-- <= 0) {
					clearInterval(timer);
					if (targetUrl)
						window.location.href = targetUrl;
				}
			}, 1000);
		})();
	</script>
</body>
</html>